<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Recipe Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Enhanced animations and styling */
        .fade-in { 
            animation: fadeIn 0.5s ease-out; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .spin { 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            from { transform: rotate(0deg); } 
            to { transform: rotate(360deg); } 
        }
        
        .scale-hover:hover { 
            transform: scale(1.05); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .scale-hover { 
            transition: all 0.3s ease; 
        }

        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .recipe-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .step-indicator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px 0 rgba(116, 75, 162, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px 0 rgba(116, 75, 162, 0.4);
            transform: translateY(-2px);
        }

        /* Temperature icons */
        .temp-icon-hot::before { content: "üî•"; }
        .temp-icon-cold::before { content: "‚ùÑÔ∏è"; }
        .temp-icon-baked::before { content: "üî•"; }

        /* Smooth scrolling */
        html { scroll-behavior: smooth; }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="text-center glass-effect p-12 rounded-3xl shadow-2xl">
            <div class="w-16 h-16 border-4 border-white border-t-transparent rounded-full spin mx-auto mb-6"></div>
            <h2 class="text-2xl font-bold text-white mb-2">Loading Recipes</h2>
            <p class="text-white/80">Fetching fresh data from kitchen...</p>
        </div>
    </div>

    <!-- Error Screen -->
    <div id="error" class="fixed inset-0 gradient-bg flex items-center justify-center z-40 hidden">
        <div class="text-center glass-effect p-12 rounded-3xl shadow-2xl max-w-md mx-auto">
            <div class="text-8xl mb-6">üò±</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Oops! Kitchen Malfunction</h2>
            <p class="text-gray-600 mb-8" id="error-message">Unable to connect to the recipe database</p>
            <button onclick="window.location.reload()" class="btn-primary text-white px-8 py-4 rounded-2xl font-bold text-lg transition-all">
                üîÑ Try Again
            </button>
        </div>
    </div>

    <!-- Main App -->
    <main id="app" class="container mx-auto px-6 py-8">
        <!-- Header -->
        <div class="text-center mb-16 fade-in">
            <div class="inline-flex items-center gap-6 mb-8">
                <div class="p-6 bg-gradient-to-br from-orange-400 to-pink-500 rounded-3xl text-white shadow-2xl">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m15 11-1 9a3 3 0 0 1-6 0l-1-9"/>
                        <path d="m6 11 1-7c0-3.5 4.5-3.5 4.5 0v.5M15 4a2 2 0 0 1 2 2c0 .5-.5 1-1 1h-2V4Z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-6xl font-black text-gray-800 mb-2 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Recipe Guide
                    </h1>
                    <div class="w-32 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto rounded-full"></div>
                </div>
            </div>
            <p class="text-2xl text-gray-700 font-light">Step-by-step culinary excellence for every dish</p>
        </div>

        <!-- Temperature Filters -->
        <section aria-label="Recipe filters">
        <div id="filters" class="flex flex-wrap justify-center gap-6 mb-12">
            <button class="filter-btn active" data-filter="all">
                <span class="text-2xl mr-2">üçΩÔ∏è</span>
                <span>All Items</span>
            </button>
            <button class="filter-btn" data-filter="hot">
                <span class="text-2xl mr-2">‚òï</span>
                <span>Hot Drinks</span>
            </button>
            <button class="filter-btn" data-filter="cold">
                <span class="text-2xl mr-2">üßä</span>
                <span>Iced Drinks</span>
            </button>
            <button class="filter-btn" data-filter="baked">
                <span class="text-2xl mr-2">üßÅ</span>
                <span>Pastries</span>
            </button>
        </div>
        </section>

        <!-- Search -->
        <section aria-label="Recipe search">
        <div class="max-w-lg mx-auto mb-16">
            <div class="relative group">
                <svg class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400 group-focus-within:text-purple-500 transition-colors" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input type="text" id="search" placeholder="Search for delicious recipes..." 
                       class="w-full pl-16 pr-8 py-6 text-xl border-2 border-gray-200 rounded-3xl focus:ring-6 focus:ring-purple-200 focus:border-purple-500 focus:outline-none transition-all shadow-lg bg-white/80 backdrop-blur-sm">
            </div>
        </div>
        </section>

        <!-- Recipe Grid -->
        <section aria-label="Recipe collection">
        <div id="recipe-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-10">
            <!-- Recipes will be inserted here -->
        </div>

        </div>
        </section>

        <!-- Recipe Detail Modal -->
        <div id="recipe-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden">
            <div class="min-h-screen px-4 py-8 flex items-center justify-center">
                <div class="glass-effect rounded-3xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-white/20">
                    <div id="recipe-detail">
                        <!-- Recipe detail content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // SUPABASE CONFIGURATION
        const SUPABASE_URL = 'https://rnfuvgxfsefrfdkxnqoi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJuZnV2Z3hmc2VmcmZka3hucW9pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTA5OTksImV4cCI6MjA2ODQ4Njk5OX0.g1Xku7iZ4oYCaVmX0Ut0xxrTVtI3KNabfX4KxKe6i3U';

        // Initialize Supabase
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // App State
        let recipes = [];
        let filteredRecipes = [];
        let currentFilter = 'all';
        let currentSearch = '';
        let selectedRecipe = null;
        let currentStep = 0;

        // Static fallback data
        const staticRecipes = [
            {
                id: 6,
                name: "Thai Iced Coffee",
                subtitle: "Gafae Yen",
                category: "thai",
                description: "Traditional Thai coffee with condensed milk",
                prep_time: 5,
                difficulty: "easy",
                temperature: "cold",
                icon: "üáπüá≠",
                color: "orange",
                ingredients: [
                    { name: "Thai Coffee Powder", quantity: 25, unit: "g", notes: "Traditional blend" },
                    { name: "Sweetened Condensed Milk", quantity: 40, unit: "ml", notes: "While coffee is hot" },
                    { name: "Evaporated Milk", quantity: 30, unit: "ml", notes: "For floating layer" },
                    { name: "Sugar", quantity: 15, unit: "g", notes: "Adjust to taste" },
                    { name: "Ice Cubes", quantity: 200, unit: "g", notes: "Fill tall glass" }
                ],
                instructions: [
                    { step: 1, title: "Brew Coffee", description: "Brew strong coffee with 25g Thai coffee powder using 200ml hot water at 90-95¬∞C", time: "2 min", tips: "Let coffee drip slowly for best flavor" },
                    { step: 2, title: "Add Sweeteners", description: "While coffee is hot, add condensed milk and sugar. Stir well", time: "30 sec", tips: "Mix while hot so sugar dissolves completely" },
                    { step: 3, title: "Cool Down", description: "Let coffee mixture cool for 2-3 minutes", time: "3 min", tips: "Don't rush - hot coffee melts ice too fast" },
                    { step: 4, title: "Add Ice", description: "Fill tall glass with ice cubes", time: "15 sec", tips: "Use tall glass for proper presentation" },
                    { step: 5, title: "Pour & Float", description: "Pour coffee over ice, then float evaporated milk on top", time: "30 sec", tips: "Pour milk slowly over spoon back for layers" }
                ]
            },
            {
                id: 1,
                name: "Cappuccino",
                subtitle: "Classic Italian",
                category: "coffee",
                description: "Espresso with steamed milk and foam",
                prep_time: 3,
                difficulty: "medium",
                temperature: "hot",
                icon: "‚òï",
                color: "red",
                ingredients: [
                    { name: "Arabica Coffee Beans", quantity: 18, unit: "g", notes: "Freshly ground fine" },
                    { name: "Cold Milk", quantity: 150, unit: "ml", notes: "3.25% fat content" }
                ],
                instructions: [
                    { step: 1, title: "Grind & Dose", description: "Grind 18g coffee beans fine, dose into portafilter", time: "30 sec", tips: "Grind should feel like fine sand" },
                    { step: 2, title: "Tamp", description: "Level and tamp with 30lbs pressure", time: "15 sec", tips: "Keep tamper level, consistent pressure" },
                    { step: 3, title: "Extract Espresso", description: "Brew shot - 30-35ml in 25-30 seconds", time: "30 sec", tips: "Watch for golden crema formation" },
                    { step: 4, title: "Steam Milk", description: "Steam 150ml milk to 65¬∞C with microfoam", time: "45 sec", tips: "Keep wand just below surface first, then deeper" },
                    { step: 5, title: "Pour", description: "Pour steamed milk creating latte art", time: "30 sec", tips: "Pour from height first, then closer for art" }
                ]
            }
        ];

        // Utility Functions
        function getColorClasses(color) {
            const colors = {
                orange: { bg: 'bg-orange-500', hover: 'hover:bg-orange-600', light: 'bg-orange-200 border-orange-300 text-orange-800' },
                red: { bg: 'bg-red-500', hover: 'hover:bg-red-600', light: 'bg-red-200 border-red-300 text-red-800' },
                blue: { bg: 'bg-blue-500', hover: 'hover:bg-blue-600', light: 'bg-blue-200 border-blue-300 text-blue-800' },
                brown: { bg: 'bg-amber-600', hover: 'hover:bg-amber-700', light: 'bg-amber-200 border-amber-300 text-amber-800' },
                purple: { bg: 'bg-purple-500', hover: 'hover:bg-purple-600', light: 'bg-purple-200 border-purple-300 text-purple-800' }
            };
            return colors[color] || colors.blue;
        }

        function transformRecipeData(supabaseRecipes) {
            return supabaseRecipes.map(recipe => ({
                id: recipe.id,
                name: recipe.name,
                subtitle: getSubtitle(recipe.name),
                category: recipe.categories?.name?.toLowerCase() || 'other',
                description: recipe.description || '',
                prep_time: recipe.prep_time || 0,
                difficulty: getDifficulty(recipe.prep_time),
                temperature: getTemperature(recipe.name),
                icon: getIcon(recipe.name, recipe.categories?.name),
                color: getColorFromCategory(recipe.categories?.name),
                ingredients: recipe.recipe_ingredients?.map(ri => ({
                    name: ri.ingredients?.name || '',
                    quantity: parseFloat(ri.quantity) || 0,
                    unit: ri.unit || '',
                    notes: ri.notes || ''
                })) || [],
                instructions: parseInstructions(recipe.instructions)
            }));
        }

        function getSubtitle(name) {
            const subtitles = {
                'Thai Iced Coffee (Gafae Yen)': 'Gafae Yen',
                'Cappuccino': 'Classic Italian',
                'Iced Latte': 'Cold Coffee',
                'Thai Coffee Frappe': 'Blended',
                'Iced Mocha': 'Chocolate Coffee',
                'Chocolate Muffin': 'Fresh Baked'
            };
            return subtitles[name] || '';
        }

        function getDifficulty(prepTime) {
            if (prepTime <= 3) return 'easy';
            if (prepTime <= 10) return 'medium';
            return 'hard';
        }

        function getTemperature(name) {
            if (name.toLowerCase().includes('iced') || name.toLowerCase().includes('cold') || name.toLowerCase().includes('frappe')) return 'cold';
            if (name.toLowerCase().includes('muffin') || name.toLowerCase().includes('cupcake')) return 'baked';
            return 'hot';
        }

        function getIcon(name, category) {
            if (name.includes('Thai')) return 'üáπüá≠';
            if (name.includes('Cappuccino')) return '‚òï';
            if (name.includes('Iced Latte')) return 'üßä';
            if (name.includes('Frappe')) return 'ü•§';
            if (name.includes('Mocha')) return 'üç´';
            if (name.includes('Muffin')) return 'üßÅ';
            return '‚òï';
        }

        function getColorFromCategory(categoryName) {
            const colors = {
                'Coffee Drinks': 'red',
                'Pastries': 'purple',
                'Tea & Other Drinks': 'green'
            };
            return colors[categoryName] || 'blue';
        }

        function parseInstructions(instructionsText) {
            if (!instructionsText) return [];
            const steps = instructionsText.split('\\n').filter(step => step.trim());
            return steps.map((step, index) => ({
                step: index + 1,
                title: `Step ${index + 1}`,
                description: step.replace(/^\d+\.\s*/, ''),
                time: '1 min',
                tips: ''
            }));
        }

        // Data Loading
        async function loadRecipes() {
            try {
                console.log('Loading recipes from Supabase...');
                const { data, error } = await supabaseClient
                    .from('recipes')
                    .select(`
                        *,
                        categories(name, color),
                        recipe_ingredients(
                            quantity,
                            unit,
                            notes,
                            ingredients(name)
                        )
                    `);

                if (error) throw error;
                
                recipes = transformRecipeData(data || []);
                console.log('‚úÖ Loaded', recipes.length, 'recipes from Supabase');
            } catch (error) {
                console.warn('‚ùå Supabase error, using static data:', error.message);
                recipes = staticRecipes;
            }
            
            filterRecipes();
            hideLoading();
        }

        // Filtering and Search
        function filterRecipes() {
            filteredRecipes = recipes.filter(recipe => {
                const matchesFilter = currentFilter === 'all' || recipe.temperature === currentFilter;
                const matchesSearch = recipe.name.toLowerCase().includes(currentSearch.toLowerCase());
                return matchesFilter && matchesSearch;
            });
            renderRecipes();
        }

        // Rendering Functions
        function renderRecipes() {
            const grid = document.getElementById('recipe-grid');
            grid.innerHTML = '';

            filteredRecipes.forEach((recipe, index) => {
                const colors = getColorClasses(recipe.color);
                const recipeCard = document.createElement('div');
                recipeCard.className = 'recipe-card rounded-3xl shadow-xl scale-hover cursor-pointer p-10 text-center fade-in';
                recipeCard.style.animationDelay = `${index * 0.1}s`;
                recipeCard.onclick = () => openRecipeModal(recipe);

                // Temperature icon based on type
                const tempIconClass = recipe.temperature === 'hot' ? 'temp-icon-hot' : 
                                     recipe.temperature === 'cold' ? 'temp-icon-cold' : 'temp-icon-baked';

                recipeCard.innerHTML = `
                    <div class="relative mb-8">
                        <div class="text-9xl mb-6 transform hover:scale-110 transition-transform duration-300">${recipe.icon}</div>
                        <div class="inline-flex items-center gap-3 px-6 py-3 rounded-full text-lg font-bold ${colors.light} shadow-lg">
                            <span class="${tempIconClass}"></span>
                            <span class="capitalize">${recipe.temperature}</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h2 class="text-3xl font-black text-gray-800 leading-tight">${recipe.name}</h2>
                        <p class="text-xl text-purple-600 font-semibold">${recipe.subtitle}</p>
                        <p class="text-gray-700 text-lg leading-relaxed px-4">${recipe.description}</p>
                        
                        <div class="flex justify-center items-center gap-8 pt-4">
                            <div class="flex items-center gap-3 bg-gray-100 px-4 py-2 rounded-full">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                                <span class="font-bold text-gray-800">${recipe.prep_time} min</span>
                            </div>
                            <div class="px-4 py-2 rounded-full font-bold text-sm ${
                                recipe.difficulty === 'easy' ? 'bg-emerald-200 text-emerald-800 shadow-emerald-200' :
                                recipe.difficulty === 'medium' ? 'bg-amber-200 text-amber-800 shadow-amber-200' :
                                'bg-red-200 text-red-800 shadow-red-200'
                            } shadow-lg">
                                ${recipe.difficulty.toUpperCase()}
                            </div>
                        </div>
                    </div>
                `;

                grid.appendChild(recipeCard);
            });
        }

        function openRecipeModal(recipe) {
            selectedRecipe = recipe;
            currentStep = 0;
            renderRecipeDetail();
            document.getElementById('recipe-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeRecipeModal() {
            document.getElementById('recipe-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function renderRecipeDetail() {
            const detail = document.getElementById('recipe-detail');
            const colors = getColorClasses(selectedRecipe.color);

            detail.innerHTML = `
                <div class="p-12">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-12">
                        <div class="flex items-center gap-8">
                            <div class="text-8xl">${selectedRecipe.icon}</div>
                            <div>
                                <h1 class="text-5xl font-black text-gray-800 mb-3 leading-tight">${selectedRecipe.name}</h1>
                                <p class="text-2xl text-purple-600 font-semibold mb-2">${selectedRecipe.subtitle}</p>
                                <p class="text-xl text-gray-700">${selectedRecipe.description}</p>
                                <div class="flex items-center gap-6 mt-4">
                                    <div class="flex items-center gap-2 bg-purple-100 px-4 py-2 rounded-full">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-600">
                                            <circle cx="12" cy="12" r="10"/>
                                            <polyline points="12,6 12,12 16,14"/>
                                        </svg>
                                        <span class="font-bold text-purple-700">${selectedRecipe.prep_time} minutes</span>
                                    </div>
                                    <div class="px-4 py-2 rounded-full font-bold ${
                                        selectedRecipe.difficulty === 'easy' ? 'bg-emerald-200 text-emerald-800' :
                                        selectedRecipe.difficulty === 'medium' ? 'bg-amber-200 text-amber-800' :
                                        'bg-red-200 text-red-800'
                                    }">
                                        ${selectedRecipe.difficulty.toUpperCase()}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="closeRecipeModal()" class="text-gray-400 hover:text-gray-600 text-4xl font-light w-12 h-12 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all">√ó</button>
                    </div>

                    <!-- Ingredients -->
                    <div class="mb-12">
                        <h3 class="text-3xl font-black text-gray-800 mb-8 flex items-center gap-3">
                            <span class="text-4xl">üõí</span>
                            Ingredients
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${selectedRecipe.ingredients.map(ingredient => `
                                <div class="recipe-card rounded-2xl p-6 border-l-4 border-purple-400">
                                    <div class="flex justify-between items-start mb-3">
                                        <h3 class="font-black text-gray-800 text-lg">${ingredient.name}</h3>
                                        <span class="font-black text-2xl text-purple-600">${ingredient.quantity} ${ingredient.unit}</span>
                                    </div>
                                    ${ingredient.notes ? `<p class="text-gray-700 italic">${ingredient.notes}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Instructions -->
                    <div>
                        <h3 class="text-3xl font-black text-gray-800 mb-8 flex items-center gap-3">
                            <span class="text-4xl">üë®‚Äçüç≥</span>
                            Instructions
                        </h3>
                        
                        <!-- Step Navigation -->
                        <div class="flex gap-3 mb-8 overflow-x-auto pb-4">
                            ${selectedRecipe.instructions.map((step, index) => `
                                <button onclick="setCurrentStep(${index})" 
                                        class="px-6 py-4 rounded-2xl font-bold whitespace-nowrap transition-all text-lg ${
                                            currentStep === index 
                                                ? `${colors.bg} text-white shadow-lg transform scale-105` 
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:scale-105'
                                        }">
                                    Step ${step.step}
                                </button>
                            `).join('')}
                        </div>

                        <!-- Current Step -->
                        <div class="${colors.light} border-2 rounded-3xl p-8 shadow-lg">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="text-2xl font-black text-gray-800">
                                    Step ${selectedRecipe.instructions[currentStep].step}: ${selectedRecipe.instructions[currentStep].title}
                                </h4>
                                <div class="flex items-center gap-3 bg-white px-6 py-3 rounded-full shadow-lg">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-500">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12,6 12,12 16,14"/>
                                    </svg>
                                    <span class="font-black text-lg text-gray-700">${selectedRecipe.instructions[currentStep].time}</span>
                                </div>
                            </div>
                            
                            <p class="text-xl text-gray-800 mb-6 leading-relaxed font-medium">
                                ${selectedRecipe.instructions[currentStep].description}
                            </p>
                            
                            ${selectedRecipe.instructions[currentStep].tips ? `
                                <div class="bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-200 rounded-2xl p-6">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="text-2xl">üí°</span>
                                        <span class="font-black text-xl text-amber-800">Pro Tip:</span>
                                    </div>
                                    <p class="text-amber-700 text-lg font-medium">${selectedRecipe.instructions[currentStep].tips}</p>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Navigation -->
                        <div class="flex justify-between items-center mt-8">
                            <button onclick="previousStep()" 
                                    ${currentStep === 0 ? 'disabled' : ''}
                                    class="px-8 py-4 bg-gray-200 text-gray-700 rounded-2xl font-bold text-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105">
                                ‚Üê Previous
                            </button>
                            
                            <div class="flex items-center gap-4">
                                <span class="text-xl font-bold text-gray-600 bg-gray-100 px-6 py-3 rounded-full">
                                    ${currentStep + 1} of ${selectedRecipe.instructions.length}
                                </span>
                            </div>
                            
                            <button onclick="nextStep()" 
                                    ${currentStep === selectedRecipe.instructions.length - 1 ? 'disabled' : ''}
                                    class="px-8 py-4 btn-primary text-white rounded-2xl font-bold text-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105">
                                Next ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Step Navigation
        function setCurrentStep(step) {
            currentStep = step;
            renderRecipeDetail();
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                renderRecipeDetail();
            }
        }

        function nextStep() {
            if (currentStep < selectedRecipe.instructions.length - 1) {
                currentStep++;
                renderRecipeDetail();
            }
        }

        // UI State Management
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    filterRecipes();
                });
            });

            // Search input
            document.getElementById('search').addEventListener('input', function() {
                currentSearch = this.value;
                filterRecipes();
            });

            // Close modal on background click
            document.getElementById('recipe-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeRecipeModal();
                }
            });

            // Escape key to close modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeRecipeModal();
                }
            });

            // Load recipes
            loadRecipes();
        });

        // CSS for filter buttons
        const style = document.createElement('style');
        style.textContent = `
            .filter-btn {
                @apply px-10 py-5 rounded-3xl font-bold text-lg transition-all shadow-lg;
                background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                color: #374151;
                display: flex;
                align-items: center;
                min-width: 160px;
                justify-content: center;
            }
            .filter-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                border-color: #a855f7;
            }
            .filter-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: transparent;
                box-shadow: 0 8px 25px rgba(116, 75, 162, 0.3);
                transform: translateY(-2px);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>